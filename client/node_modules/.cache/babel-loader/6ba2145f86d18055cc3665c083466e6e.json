{"ast":null,"code":"import _objectSpread from\"D:/Web Development/React-Project-1/server/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Web Development/React-Project-1/server/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Web Development/React-Project-1/server/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Web Development/React-Project-1/server/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{useSelector,useDispatch}from'react-redux';import{addressActions}from'../../store/addressStore';import classes from'./addressForm.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AddressForm(props){var userSub=useSelector(function(state){return state.login.userData;});var dispatch=useDispatch();var navigate=useNavigate();var msg={mobNo:\"ok\",pinCode:\"ok\"};var _useState=useState(\" \"),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(\" \"),_useState4=_slicedToArray(_useState3,2),mob=_useState4[0],setMob=_useState4[1];var _useState5=useState(\" \"),_useState6=_slicedToArray(_useState5,2),pin=_useState6[0],setPin=_useState6[1];var _useState7=useState(\" \"),_useState8=_slicedToArray(_useState7,2),house=_useState8[0],setHouse=_useState8[1];var _useState9=useState(\" \"),_useState10=_slicedToArray(_useState9,2),town=_useState10[0],setTown=_useState10[1];var _useState11=useState(\" \"),_useState12=_slicedToArray(_useState11,2),landmark=_useState12[0],setLandmark=_useState12[1];var _useState13=useState(\" \"),_useState14=_slicedToArray(_useState13,2),city=_useState14[0],setCity=_useState14[1];var _useState15=useState(\" \"),_useState16=_slicedToArray(_useState15,2),state=_useState16[0],setState=_useState16[1];var _useState17=useState(msg),_useState18=_slicedToArray(_useState17,2),errMsg=_useState18[0],setErrMsg=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),addr=_useState20[0],setAddr=_useState20[1];useEffect(function(){//get address data mongodb\nfunction getAddress(_x){return _getAddress.apply(this,arguments);}function _getAddress(){_getAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(email){var res,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"/api/user/history-get\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:email})});case 2:res=_context.sent;_context.next=5;return res.json();case 5:data=_context.sent;if(res.ok&&data.address)setAddr(data.address);case 7:case\"end\":return _context.stop();}}},_callee);}));return _getAddress.apply(this,arguments);}getAddress(userSub.email);},[userSub.email]);//post address\nfunction postAddress(_x2,_x3){return _postAddress.apply(this,arguments);}function _postAddress(){_postAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,address){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"/api/user/history-create\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:email,address:address})});case 2:res=_context2.sent;_context2.next=5;return res.json();case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _postAddress.apply(this,arguments);}function toPayment(){navigate(\"/payment\",{replace:true});}function addressSave(event){event.preventDefault();if(errMsg.mobNo!==\"ok\"||errMsg.pinCode!==\"ok\")return;var newAddress=addr.slice();var id=\"a\"+newAddress.length;newAddress.push({_id:id,name:name,mobile:mob,house:house,town:town,landmark:landmark,city:city,state:state,pin:pin});postAddress(userSub.email,newAddress);dispatch(addressActions.addAddress({name:name,mobile:mob,house:house,town:town,landmark:landmark,city:city,state:state,pin:pin}));toPayment();}function nameHandler(event){setName(event.target.value);}function mobHandler(event){var contact=event.target.value;if(contact===\"\"){setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{mobNo:\"This is a mandatory field\"}));return;}setMob(contact);if(contact.length<10)setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{mobNo:\"Minimum length is 10\"}));else if(/^\\d+$/.test(contact)===false||contact.charAt(0)<6)setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{mobNo:\"Please enter a valid 10 digit mobile number\"}));else setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{mobNo:\"ok\"}));}function pinHandler(_x4){return _pinHandler.apply(this,arguments);}function _pinHandler(){_pinHandler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var code,data,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:code=event.target.value;if(!(code===\"\")){_context3.next=4;break;}setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{pinCode:\"This is a mandatory field\"}));return _context3.abrupt(\"return\");case 4:setPin(code);_context3.prev=5;_context3.next=8;return fetch(\"/api/user/getPinData/\".concat(code),{method:\"GET\",headers:{\"Content-Type\":\"application/json\"}});case 8:res=_context3.sent;_context3.next=11;return res.json();case 11:data=_context3.sent;_context3.next=18;break;case 14:_context3.prev=14;_context3.t0=_context3[\"catch\"](5);console.log(_context3.t0);return _context3.abrupt(\"return\");case 18:if(!(data.Status===\"Error\"||data.PostOffice===null)){_context3.next=21;break;}setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{pinCode:\"Invalid pincode\"}));return _context3.abrupt(\"return\");case 21:setErrMsg(_objectSpread(_objectSpread({},errMsg),{},{pinCode:\"ok\"}));setCity(data.PostOffice[0].Taluk);setState(data.PostOffice[0].State);case 24:case\"end\":return _context3.stop();}}},_callee3,null,[[5,14]]);}));return _pinHandler.apply(this,arguments);}function houseHandler(event){setHouse(event.target.value);}function townHandler(event){setTown(event.target.value);}function landmarkHandler(event){setLandmark(event.target.value);}return/*#__PURE__*/_jsxs(\"form\",{onSubmit:addressSave,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.con,children:[/*#__PURE__*/_jsx(\"p\",{className:classes.head,children:\"CONTACT DETAILS\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\" \",required:true,className:classes.textBox,onBlur:nameHandler}),/*#__PURE__*/_jsx(\"label\",{className:classes.formLabel,children:\"Name*\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\" \",maxlength:\"10\",required:true,className:classes.textBox,onBlur:mobHandler}),/*#__PURE__*/_jsx(\"label\",{className:classes.formLabel,children:\"Mobile No*\"}),errMsg.mobNo!==\"ok\"&&/*#__PURE__*/_jsx(\"p\",{className:classes.errmsg,children:errMsg.mobNo})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.add,children:[/*#__PURE__*/_jsx(\"p\",{className:classes.head,children:\"ADDRESS\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\" \",maxlength:\"6\",required:true,className:classes.textBox,onBlur:pinHandler}),/*#__PURE__*/_jsx(\"label\",{className:classes.formLabel,children:\"Pin Code*\"}),errMsg.pinCode!==\"ok\"&&/*#__PURE__*/_jsx(\"p\",{className:classes.errmsg,children:errMsg.pinCode})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\" \",required:true,className:classes.textBox,onBlur:houseHandler}),/*#__PURE__*/_jsx(\"label\",{className:classes.formLabel,children:\"Address(House No, Building, Street, Area)*\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\" \",required:true,className:classes.textBox,onBlur:townHandler}),/*#__PURE__*/_jsx(\"label\",{className:classes.formLabel,children:\"Locality/Town*\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\" \",className:classes.textBox,onBlur:landmarkHandler}),/*#__PURE__*/_jsx(\"label\",{className:classes.formLabel,children:\"Landmark (optional)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[city===\" \"&&/*#__PURE__*/_jsx(\"div\",{className:classes.fixed,children:\"City/District*\"}),city!==\" \"&&/*#__PURE__*/_jsx(\"div\",{className:classes.fixed,children:city})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.details,children:[state===\" \"&&/*#__PURE__*/_jsx(\"div\",{className:classes.fixed,children:\"State*\"}),state!==\" \"&&/*#__PURE__*/_jsx(\"div\",{className:classes.fixed,children:state})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",value:\"Submit\",className:classes.save,children:\"ADD ADDRESS\"})]});}export default AddressForm;","map":{"version":3,"sources":["D:/Web Development/React-Project-1/server/client/src/pages/address/addressForm.js"],"names":["React","useState","useEffect","useNavigate","useSelector","useDispatch","addressActions","classes","AddressForm","props","userSub","state","login","userData","dispatch","navigate","msg","mobNo","pinCode","name","setName","mob","setMob","pin","setPin","house","setHouse","town","setTown","landmark","setLandmark","city","setCity","setState","errMsg","setErrMsg","addr","setAddr","getAddress","email","fetch","method","headers","body","JSON","stringify","res","json","data","ok","address","postAddress","toPayment","replace","addressSave","event","preventDefault","newAddress","slice","id","length","push","_id","mobile","addAddress","nameHandler","target","value","mobHandler","contact","test","charAt","pinHandler","code","console","log","Status","PostOffice","Taluk","State","houseHandler","townHandler","landmarkHandler","con","head","details","textBox","formLabel","errmsg","add","fixed","save"],"mappings":"wgBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CAEA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,cAAT,KAA+B,0BAA/B,CACA,MAAOC,CAAAA,OAAP,KAAoB,0BAApB,C,wFAEA,QAASC,CAAAA,WAAT,CAAqBC,KAArB,CAA2B,CAEvB,GAAMC,CAAAA,OAAO,CAAGN,WAAW,CAAC,SAACO,KAAD,QAAWA,CAAAA,KAAK,CAACC,KAAN,CAAYC,QAAvB,EAAD,CAA3B,CACA,GAAMC,CAAAA,QAAQ,CAAGT,WAAW,EAA5B,CACA,GAAIU,CAAAA,QAAQ,CAAGZ,WAAW,EAA1B,CAEA,GAAMa,CAAAA,GAAG,CAAG,CAACC,KAAK,CAAE,IAAR,CAAcC,OAAO,CAAE,IAAvB,CAAZ,CAEA,cAAwBjB,QAAQ,CAAC,GAAD,CAAhC,wCAAOkB,IAAP,eAAaC,OAAb,eACA,eAAsBnB,QAAQ,CAAC,GAAD,CAA9B,yCAAOoB,GAAP,eAAYC,MAAZ,eACA,eAAsBrB,QAAQ,CAAC,GAAD,CAA9B,yCAAOsB,GAAP,eAAYC,MAAZ,eACA,eAA0BvB,QAAQ,CAAC,GAAD,CAAlC,yCAAOwB,KAAP,eAAcC,QAAd,eACA,eAAwBzB,QAAQ,CAAC,GAAD,CAAhC,0CAAO0B,IAAP,gBAAaC,OAAb,gBACA,gBAAgC3B,QAAQ,CAAC,GAAD,CAAxC,2CAAO4B,QAAP,gBAAiBC,WAAjB,gBACA,gBAAwB7B,QAAQ,CAAC,GAAD,CAAhC,2CAAO8B,IAAP,gBAAaC,OAAb,gBACA,gBAA0B/B,QAAQ,CAAC,GAAD,CAAlC,2CAAOU,KAAP,gBAAcsB,QAAd,gBACA,gBAA4BhC,QAAQ,CAACe,GAAD,CAApC,2CAAOkB,MAAP,gBAAeC,SAAf,gBACA,gBAAwBlC,QAAQ,CAAC,EAAD,CAAhC,2CAAOmC,IAAP,gBAAaC,OAAb,gBAEAnC,SAAS,CAAC,UAAK,CAEX;AAFW,QAGIoC,CAAAA,UAHJ,0IAGX,iBAA0BC,KAA1B,qJAEsBC,CAAAA,KAAK,CAAC,uBAAD,CAA0B,CAC7CC,MAAM,CAAE,MADqC,CAE7CC,OAAO,CAAC,CACJ,eAAgB,kBADZ,CAFqC,CAK7CC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAEN,KAAK,CAALA,KAAF,CAAf,CALuC,CAA1B,CAF3B,QAEUO,GAFV,qCAUuBA,CAAAA,GAAG,CAACC,IAAJ,EAVvB,QAUUC,IAVV,eAYI,GAAGF,GAAG,CAACG,EAAJ,EAAUD,IAAI,CAACE,OAAlB,CACIb,OAAO,CAACW,IAAI,CAACE,OAAN,CAAP,CAbR,sDAHW,6CAmBXZ,UAAU,CAAC5B,OAAO,CAAC6B,KAAT,CAAV,CAEH,CArBQ,CAqBN,CAAC7B,OAAO,CAAC6B,KAAT,CArBM,CAAT,CAuBA;AA1CuB,QA2CRY,CAAAA,WA3CQ,kJA2CvB,kBAA2BZ,KAA3B,CAAkCW,OAAlC,qJAEsBV,CAAAA,KAAK,CAAC,0BAAD,CAA6B,CAChDC,MAAM,CAAE,MADwC,CAEhDC,OAAO,CAAC,CACJ,eAAgB,kBADZ,CAFwC,CAKhDC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAEN,KAAK,CAALA,KAAF,CAASW,OAAO,CAAPA,OAAT,CAAf,CAL0C,CAA7B,CAF3B,QAEUJ,GAFV,uCAUUA,CAAAA,GAAG,CAACC,IAAJ,EAVV,yDA3CuB,8CAyDvB,QAASK,CAAAA,SAAT,EAAoB,CAChBrC,QAAQ,YAAa,CAAEsC,OAAO,CAAE,IAAX,CAAb,CAAR,CACH,CAED,QAASC,CAAAA,WAAT,CAAqBC,KAArB,CAA2B,CACvBA,KAAK,CAACC,cAAN,GAEA,GAAGtB,MAAM,CAACjB,KAAP,GAAiB,IAAjB,EAAyBiB,MAAM,CAAChB,OAAP,GAAmB,IAA/C,CACI,OAEJ,GAAIuC,CAAAA,UAAU,CAAGrB,IAAI,CAACsB,KAAL,EAAjB,CAEA,GAAMC,CAAAA,EAAE,CAAG,IAAIF,UAAU,CAACG,MAA1B,CACAH,UAAU,CAACI,IAAX,CAAgB,CACZC,GAAG,CAAEH,EADO,CAEZxC,IAAI,CAAGA,IAFK,CAGZ4C,MAAM,CAAG1C,GAHG,CAIZI,KAAK,CAAGA,KAJI,CAKZE,IAAI,CAAGA,IALK,CAMZE,QAAQ,CAAEA,QANE,CAOZE,IAAI,CAAGA,IAPK,CAQZpB,KAAK,CAAGA,KARI,CASZY,GAAG,CAAGA,GATM,CAAhB,EAYA4B,WAAW,CAACzC,OAAO,CAAC6B,KAAT,CAAgBkB,UAAhB,CAAX,CAEA3C,QAAQ,CAACR,cAAc,CAAC0D,UAAf,CAA0B,CAC/B7C,IAAI,CAAGA,IADwB,CAE/B4C,MAAM,CAAG1C,GAFsB,CAG/BI,KAAK,CAAGA,KAHuB,CAI/BE,IAAI,CAAGA,IAJwB,CAK/BE,QAAQ,CAAEA,QALqB,CAM/BE,IAAI,CAAGA,IANwB,CAO/BpB,KAAK,CAAGA,KAPuB,CAQ/BY,GAAG,CAAGA,GARyB,CAA1B,CAAD,CAAR,CAWA6B,SAAS,GAGZ,CAED,QAASa,CAAAA,WAAT,CAAqBV,KAArB,CAA2B,CACvBnC,OAAO,CAACmC,KAAK,CAACW,MAAN,CAAaC,KAAd,CAAP,CACH,CACD,QAASC,CAAAA,UAAT,CAAoBb,KAApB,CAA0B,CACtB,GAAMc,CAAAA,OAAO,CAAGd,KAAK,CAACW,MAAN,CAAaC,KAA7B,CACA,GAAGE,OAAO,GAAK,EAAf,CAAkB,CACdlC,SAAS,gCAAMD,MAAN,MAAcjB,KAAK,CAAE,2BAArB,GAAT,CACA,OACH,CAEDK,MAAM,CAAC+C,OAAD,CAAN,CAEA,GAAGA,OAAO,CAACT,MAAR,CAAiB,EAApB,CACIzB,SAAS,gCAAMD,MAAN,MAAcjB,KAAK,CAAE,sBAArB,GAAT,CADJ,IAEK,IAAG,QAAQqD,IAAR,CAAaD,OAAb,IAA0B,KAA1B,EAAmCA,OAAO,CAACE,MAAR,CAAe,CAAf,EAAoB,CAA1D,CACDpC,SAAS,gCAAMD,MAAN,MAAcjB,KAAK,CAAE,6CAArB,GAAT,CADC,IAGDkB,CAAAA,SAAS,gCAAMD,MAAN,MAAcjB,KAAK,CAAE,IAArB,GAAT,CACP,CAtHsB,QAuHRuD,CAAAA,UAvHQ,2IAuHvB,kBAA0BjB,KAA1B,wIACUkB,IADV,CACiBlB,KAAK,CAACW,MAAN,CAAaC,KAD9B,MAEOM,IAAI,GAAK,EAFhB,2BAGQtC,SAAS,gCAAMD,MAAN,MAAchB,OAAO,CAAE,2BAAvB,GAAT,CAHR,yCAOIM,MAAM,CAACiD,IAAD,CAAN,CAPJ,wCAY0BjC,CAAAA,KAAK,gCAAyBiC,IAAzB,EAAiC,CACpDhC,MAAM,CAAE,KAD4C,CAEpDC,OAAO,CAAC,CACJ,eAAgB,kBADZ,CAF4C,CAAjC,CAZ/B,QAYcI,GAZd,wCAkBqBA,CAAAA,GAAG,CAACC,IAAJ,EAlBrB,SAkBQC,IAlBR,qGAsBQ0B,OAAO,CAACC,GAAR,eAtBR,+CA0BO3B,IAAI,CAAC4B,MAAL,GAAgB,OAAhB,EAA2B5B,IAAI,CAAC6B,UAAL,GAAoB,IA1BtD,4BA2BQ1C,SAAS,gCAAMD,MAAN,MAAchB,OAAO,CAAE,iBAAvB,GAAT,CA3BR,0CA+BIiB,SAAS,gCAAMD,MAAN,MAAchB,OAAO,CAAE,IAAvB,GAAT,CAEAc,OAAO,CAACgB,IAAI,CAAC6B,UAAL,CAAgB,CAAhB,EAAmBC,KAApB,CAAP,CACA7C,QAAQ,CAACe,IAAI,CAAC6B,UAAL,CAAgB,CAAhB,EAAmBE,KAApB,CAAR,CAlCJ,uEAvHuB,6CA6JvB,QAASC,CAAAA,YAAT,CAAsBzB,KAAtB,CAA4B,CACxB7B,QAAQ,CAAC6B,KAAK,CAACW,MAAN,CAAaC,KAAd,CAAR,CACH,CACD,QAASc,CAAAA,WAAT,CAAqB1B,KAArB,CAA2B,CACvB3B,OAAO,CAAC2B,KAAK,CAACW,MAAN,CAAaC,KAAd,CAAP,CACH,CACD,QAASe,CAAAA,eAAT,CAAyB3B,KAAzB,CAA+B,CAC3BzB,WAAW,CAACyB,KAAK,CAACW,MAAN,CAAaC,KAAd,CAAX,CACH,CAGD,mBACI,cAAM,QAAQ,CAAEb,WAAhB,wBACI,aAAK,SAAS,CAAE/C,OAAO,CAAC4E,GAAxB,wBACI,UAAG,SAAS,CAAE5E,OAAO,CAAC6E,IAAtB,6BADJ,cAEI,aAAK,SAAS,CAAE7E,OAAO,CAAC8E,OAAxB,wBACI,cACI,IAAI,CAAE,MADV,CAEI,WAAW,CAAC,GAFhB,CAGI,QAAQ,KAHZ,CAII,SAAS,CAAE9E,OAAO,CAAC+E,OAJvB,CAKI,MAAM,CAAIrB,WALd,EADJ,cAQI,cAAO,SAAS,CAAE1D,OAAO,CAACgF,SAA1B,mBARJ,GAFJ,cAcI,aAAK,SAAS,CAAEhF,OAAO,CAAC8E,OAAxB,wBACI,cACI,IAAI,CAAE,MADV,CAEI,WAAW,CAAC,GAFhB,CAGI,SAAS,CAAC,IAHd,CAII,QAAQ,KAJZ,CAKI,SAAS,CAAE9E,OAAO,CAAC+E,OALvB,CAMI,MAAM,CAAIlB,UANd,EADJ,cASI,cAAO,SAAS,CAAE7D,OAAO,CAACgF,SAA1B,wBATJ,CAYKrD,MAAM,CAACjB,KAAP,GAAiB,IAAjB,eAAyB,UAAG,SAAS,CAAEV,OAAO,CAACiF,MAAtB,UAA+BtD,MAAM,CAACjB,KAAtC,EAZ9B,GAdJ,GADJ,cA8BI,aAAK,SAAS,CAAEV,OAAO,CAACkF,GAAxB,wBACI,UAAG,SAAS,CAAElF,OAAO,CAAC6E,IAAtB,qBADJ,cAEI,aAAK,SAAS,CAAE7E,OAAO,CAAC8E,OAAxB,wBACI,cACI,IAAI,CAAE,MADV,CAEI,WAAW,CAAC,GAFhB,CAGI,SAAS,CAAC,GAHd,CAII,QAAQ,KAJZ,CAKI,SAAS,CAAE9E,OAAO,CAAC+E,OALvB,CAMI,MAAM,CAAId,UANd,EADJ,cASI,cAAO,SAAS,CAAEjE,OAAO,CAACgF,SAA1B,uBATJ,CAYKrD,MAAM,CAAChB,OAAP,GAAmB,IAAnB,eAA2B,UAAG,SAAS,CAAEX,OAAO,CAACiF,MAAtB,UAA+BtD,MAAM,CAAChB,OAAtC,EAZhC,GAFJ,cAgBI,aAAK,SAAS,CAAEX,OAAO,CAAC8E,OAAxB,wBACI,cACI,IAAI,CAAE,MADV,CAEI,WAAW,CAAC,GAFhB,CAGI,QAAQ,KAHZ,CAII,SAAS,CAAE9E,OAAO,CAAC+E,OAJvB,CAKI,MAAM,CAAIN,YALd,EADJ,cAQI,cAAO,SAAS,CAAEzE,OAAO,CAACgF,SAA1B,wDARJ,GAhBJ,cA4BI,aAAK,SAAS,CAAEhF,OAAO,CAAC8E,OAAxB,wBACI,cACI,IAAI,CAAE,MADV,CAEI,WAAW,CAAC,GAFhB,CAGI,QAAQ,KAHZ,CAII,SAAS,CAAE9E,OAAO,CAAC+E,OAJvB,CAKI,MAAM,CAAIL,WALd,EADJ,cAQI,cAAO,SAAS,CAAE1E,OAAO,CAACgF,SAA1B,4BARJ,GA5BJ,cAwCI,aAAK,SAAS,CAAEhF,OAAO,CAAC8E,OAAxB,wBACI,cACI,IAAI,CAAE,MADV,CAEI,WAAW,CAAC,GAFhB,CAGI,SAAS,CAAE9E,OAAO,CAAC+E,OAHvB,CAII,MAAM,CAAIJ,eAJd,EADJ,cAOI,cAAO,SAAS,CAAE3E,OAAO,CAACgF,SAA1B,iCAPJ,GAxCJ,cAmDI,aAAK,SAAS,CAAEhF,OAAO,CAAC8E,OAAxB,WACKtD,IAAI,GAAK,GAAT,eAAgB,YAAK,SAAS,CAAExB,OAAO,CAACmF,KAAxB,4BADrB,CAEK3D,IAAI,GAAK,GAAT,eAAgB,YAAK,SAAS,CAAExB,OAAO,CAACmF,KAAxB,UAAgC3D,IAAhC,EAFrB,GAnDJ,cAuDI,aAAK,SAAS,CAAExB,OAAO,CAAC8E,OAAxB,WACK1E,KAAK,GAAK,GAAV,eAAiB,YAAK,SAAS,CAAEJ,OAAO,CAACmF,KAAxB,oBADtB,CAEK/E,KAAK,GAAK,GAAV,eAAiB,YAAK,SAAS,CAAEJ,OAAO,CAACmF,KAAxB,UAAgC/E,KAAhC,EAFtB,GAvDJ,GA9BJ,cA0FI,eAAQ,IAAI,CAAE,QAAd,CAAuB,KAAK,CAAC,QAA7B,CAAsC,SAAS,CAAEJ,OAAO,CAACoF,IAAzD,yBA1FJ,GADJ,CA8FH,CAED,cAAenF,CAAAA,WAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\r\n\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { addressActions } from '../../store/addressStore';\r\nimport classes from './addressForm.module.css';\r\n\r\nfunction AddressForm(props){\r\n\r\n    const userSub = useSelector((state) => state.login.userData);\r\n    const dispatch = useDispatch();\r\n    let navigate = useNavigate();\r\n\r\n    const msg = {mobNo: \"ok\", pinCode: \"ok\"};\r\n\r\n    const [name, setName] = useState(\" \");\r\n    const [mob, setMob] = useState(\" \");\r\n    const [pin, setPin] = useState(\" \");\r\n    const [house, setHouse] = useState(\" \");\r\n    const [town, setTown] = useState(\" \");\r\n    const [landmark, setLandmark] = useState(\" \");\r\n    const [city, setCity] = useState(\" \");\r\n    const [state, setState] = useState(\" \");\r\n    const [errMsg, setErrMsg] = useState(msg);\r\n    const [addr, setAddr] = useState([]);\r\n\r\n    useEffect(() =>{\r\n\r\n        //get address data mongodb\r\n        async function getAddress(email){\r\n\r\n            const res = await fetch(\"/api/user/history-get\", {\r\n                method: \"POST\",\r\n                headers:{\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({ email })\r\n            });\r\n        \r\n            const data = await res.json();\r\n                \r\n            if(res.ok && data.address)\r\n                setAddr(data.address);\r\n\r\n        }\r\n        getAddress(userSub.email);\r\n\r\n    }, [userSub.email]);\r\n\r\n    //post address\r\n    async function postAddress(email, address){\r\n\r\n        const res = await fetch(\"/api/user/history-create\", {\r\n            method: \"POST\",\r\n            headers:{\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ email, address })\r\n        });\r\n    \r\n        await res.json();\r\n\r\n    }\r\n\r\n    function toPayment(){\r\n        navigate(`/payment`, { replace: true });\r\n    }\r\n\r\n    function addressSave(event){  \r\n        event.preventDefault();\r\n\r\n        if(errMsg.mobNo !== \"ok\" || errMsg.pinCode !== \"ok\")\r\n            return;\r\n\r\n        let newAddress = addr.slice();\r\n\r\n        const id = \"a\"+newAddress.length;\r\n        newAddress.push({\r\n            _id: id,\r\n            name : name,\r\n            mobile : mob,\r\n            house : house ,\r\n            town : town,\r\n            landmark: landmark,\r\n            city : city,\r\n            state : state,\r\n            pin : pin\r\n        });\r\n\r\n        postAddress(userSub.email, newAddress);\r\n\r\n        dispatch(addressActions.addAddress({\r\n            name : name,\r\n            mobile : mob,\r\n            house : house ,\r\n            town : town,\r\n            landmark: landmark,\r\n            city : city,\r\n            state : state,\r\n            pin : pin\r\n        }));\r\n\r\n        toPayment();\r\n\r\n        \r\n    }\r\n\r\n    function nameHandler(event){\r\n        setName(event.target.value);\r\n    }\r\n    function mobHandler(event){\r\n        const contact = event.target.value;\r\n        if(contact === \"\"){\r\n            setErrMsg({ ...errMsg, mobNo: \"This is a mandatory field\"});\r\n            return;\r\n        }\r\n\r\n        setMob(contact);  \r\n        \r\n        if(contact.length < 10)\r\n            setErrMsg({ ...errMsg, mobNo: \"Minimum length is 10\"});\r\n        else if(/^\\d+$/.test(contact) === false || contact.charAt(0) < 6)\r\n            setErrMsg({ ...errMsg, mobNo: \"Please enter a valid 10 digit mobile number\"});\r\n        else\r\n            setErrMsg({ ...errMsg, mobNo: \"ok\"});\r\n    }\r\n    async function pinHandler(event){\r\n        const code = event.target.value;\r\n        if(code === \"\"){\r\n            setErrMsg({ ...errMsg, pinCode: \"This is a mandatory field\"});\r\n            return;\r\n        }\r\n            \r\n        setPin(code); \r\n\r\n        let data;\r\n\r\n        try{\r\n            const res = await fetch(`/api/user/getPinData/${code}`, {\r\n                method: \"GET\",\r\n                headers:{\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n            });\r\n            data = await res.json();\r\n            \r\n        }\r\n        catch(error){\r\n            console.log(error);\r\n            return;\r\n        }\r\n\r\n        if(data.Status === \"Error\" || data.PostOffice === null){\r\n            setErrMsg({ ...errMsg, pinCode: \"Invalid pincode\"});\r\n            return;\r\n        }\r\n        \r\n        setErrMsg({ ...errMsg, pinCode: \"ok\"});\r\n\r\n        setCity(data.PostOffice[0].Taluk);\r\n        setState(data.PostOffice[0].State);\r\n\r\n        \r\n    }\r\n    function houseHandler(event){\r\n        setHouse(event.target.value);\r\n    }\r\n    function townHandler(event){\r\n        setTown(event.target.value);\r\n    }\r\n    function landmarkHandler(event){\r\n        setLandmark(event.target.value);\r\n    }\r\n\r\n\r\n    return(\r\n        <form onSubmit={addressSave}>\r\n            <div className={classes.con}>\r\n                <p className={classes.head}>CONTACT DETAILS</p>\r\n                <div className={classes.details}>\r\n                    <input \r\n                        type= \"text\" \r\n                        placeholder=' ' \r\n                        required \r\n                        className={classes.textBox}\r\n                        onBlur = {nameHandler}>\r\n                    </input>\r\n                    <label className={classes.formLabel}>\r\n                        Name*\r\n                    </label>\r\n                </div>\r\n                <div className={classes.details}>\r\n                    <input \r\n                        type= \"text\" \r\n                        placeholder=' ' \r\n                        maxlength=\"10\" \r\n                        required \r\n                        className={classes.textBox}\r\n                        onBlur = {mobHandler}>\r\n                    </input>\r\n                    <label className={classes.formLabel}>\r\n                        Mobile No*\r\n                    </label>\r\n                    {errMsg.mobNo !== \"ok\" && <p className={classes.errmsg}>{errMsg.mobNo}</p>}\r\n                </div>\r\n            </div>\r\n            <div className={classes.add}>\r\n                <p className={classes.head}>ADDRESS</p>\r\n                <div className={classes.details}>\r\n                    <input \r\n                        type= \"text\" \r\n                        placeholder=' ' \r\n                        maxlength=\"6\" \r\n                        required \r\n                        className={classes.textBox}\r\n                        onBlur = {pinHandler}>\r\n                    </input>\r\n                    <label className={classes.formLabel}>\r\n                        Pin Code*\r\n                    </label>\r\n                    {errMsg.pinCode !== \"ok\" && <p className={classes.errmsg}>{errMsg.pinCode}</p>}\r\n                </div>\r\n                <div className={classes.details}>\r\n                    <input \r\n                        type= \"text\" \r\n                        placeholder=' '  \r\n                        required \r\n                        className={classes.textBox}\r\n                        onBlur = {houseHandler}>\r\n                    </input>\r\n                    <label className={classes.formLabel}>\r\n                        Address(House No, Building, Street, Area)*\r\n                    </label>\r\n                </div>\r\n                <div className={classes.details}>\r\n                    <input \r\n                        type= \"text\" \r\n                        placeholder=' '  \r\n                        required \r\n                        className={classes.textBox}\r\n                        onBlur = {townHandler}>\r\n                    </input>\r\n                    <label className={classes.formLabel}>\r\n                        Locality/Town*\r\n                    </label>\r\n                </div>\r\n                <div className={classes.details}>\r\n                    <input \r\n                        type= \"text\" \r\n                        placeholder=' '  \r\n                        className={classes.textBox}\r\n                        onBlur = {landmarkHandler}>\r\n                    </input>\r\n                    <label className={classes.formLabel}>\r\n                        Landmark (optional)\r\n                    </label>\r\n                </div>\r\n                <div className={classes.details}>\r\n                    {city === \" \" && <div className={classes.fixed}>City/District*</div>}\r\n                    {city !== \" \" && <div className={classes.fixed}>{city}</div>}\r\n                </div>\r\n                <div className={classes.details}>\r\n                    {state === \" \" && <div className={classes.fixed}>State*</div>}\r\n                    {state !== \" \" && <div className={classes.fixed}>{state}</div>}\r\n                </div>\r\n            </div>\r\n            <button type= \"submit\" value=\"Submit\" className={classes.save}>ADD ADDRESS</button>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport default AddressForm;"]},"metadata":{},"sourceType":"module"}