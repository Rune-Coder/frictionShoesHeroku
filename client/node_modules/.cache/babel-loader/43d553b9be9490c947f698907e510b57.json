{"ast":null,"code":"import _regeneratorRuntime from\"D:/Web Development/React-Project-1/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Web Development/React-Project-1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Web Development/React-Project-1/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';function UserHistory(token){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var loggedin=true;var newtoken=token;useEffect(function(){function getData(){return _getData.apply(this,arguments);}function _getData(){_getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"/api/user/profile\",{method:\"GET\",headers:{Authorization:\"Bearer \".concat(newtoken)}});case 2:res=_context.sent;_context.next=5;return res.json();case 5:data=_context.sent;if(res.ok)setUser(data);case 7:case\"end\":return _context.stop();}}},_callee);}));return _getData.apply(this,arguments);}getData();},[newtoken]);if(Object.keys(user).length===0){token=\"\";loggedin=false;}if(!loggedin)return;//get cart data mongodb\nfunction getCartData(_x){return _getCartData.apply(this,arguments);}function _getCartData(){_getCartData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email){var res,data,bill;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"/api/user/history-get\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:email})});case 2:res=_context2.sent;_context2.next=5;return res.json();case 5:data=_context2.sent;if(res.ok){_context2.next=8;break;}return _context2.abrupt(\"return\");case 8:if(data.cart&&data.bill){localStorage.setItem(\"products\",JSON.stringify(data.cart));localStorage.setItem(\"billStore\",JSON.stringify(data.bill));if(data.bill.length===0){bill=[{tmrp:0,tdis:0,tdelfee:0,amount:0,len:0}];localStorage.setItem(\"billStore\",JSON.stringify(bill));}}if(data.wish){localStorage.setItem(\"wishStore\",JSON.stringify(data.wish));}case 10:case\"end\":return _context2.stop();}}},_callee2);}));return _getCartData.apply(this,arguments);}getCartData(user.email);}export{UserHistory};","map":{"version":3,"sources":["D:/Web Development/React-Project-1/src/connect/userHistory.js"],"names":["useState","useEffect","UserHistory","token","user","setUser","loggedin","newtoken","getData","fetch","method","headers","Authorization","res","json","data","ok","Object","keys","length","getCartData","email","body","JSON","stringify","cart","bill","localStorage","setItem","tmrp","tdis","tdelfee","amount","len","wish"],"mappings":"4VAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CAEA,QAASC,CAAAA,WAAT,CAAqBC,KAArB,CAA2B,CACvB,cAAwBH,QAAQ,CAAC,EAAD,CAAhC,wCAAOI,IAAP,eAAaC,OAAb,eACA,GAAIC,CAAAA,QAAQ,CAAG,IAAf,CACA,GAAIC,CAAAA,QAAQ,CAAGJ,KAAf,CAEAF,SAAS,CAAC,UAAK,SACIO,CAAAA,OADJ,+HACX,sKAEsBC,CAAAA,KAAK,qBAAsB,CACzCC,MAAM,CAAE,KADiC,CAEzCC,OAAO,CAAC,CACJC,aAAa,kBAAYL,QAAZ,CADT,CAFiC,CAAtB,CAF3B,QAEUM,GAFV,qCASuBA,CAAAA,GAAG,CAACC,IAAJ,EATvB,QASUC,IATV,eAWI,GAAGF,GAAG,CAACG,EAAP,CACIX,OAAO,CAACU,IAAD,CAAP,CAZR,sDADW,0CAiBXP,OAAO,GAEV,CAnBQ,CAmBN,CAACD,QAAD,CAnBM,CAAT,CAsBA,GAAGU,MAAM,CAACC,IAAP,CAAYd,IAAZ,EAAkBe,MAAlB,GAA6B,CAAhC,CAAkC,CAC9BhB,KAAK,CAAG,EAAR,CACAG,QAAQ,CAAG,KAAX,CACH,CAED,GAAG,CAACA,QAAJ,CACI,OAEJ;AAnCuB,QAoCRc,CAAAA,WApCQ,6IAoCvB,kBAA2BC,KAA3B,+JAEsBZ,CAAAA,KAAK,CAAC,uBAAD,CAA0B,CAC7CC,MAAM,CAAE,MADqC,CAE7CC,OAAO,CAAC,CACJ,eAAgB,kBADZ,CAFqC,CAK7CW,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAEH,KAAK,CAALA,KAAF,CAAf,CALuC,CAA1B,CAF3B,QAEUR,GAFV,uCAUuBA,CAAAA,GAAG,CAACC,IAAJ,EAVvB,QAUUC,IAVV,mBAYQF,GAAG,CAACG,EAZZ,mEAgBI,GAAGD,IAAI,CAACU,IAAL,EAAaV,IAAI,CAACW,IAArB,CAA0B,CACtBC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAiCL,IAAI,CAACC,SAAL,CAAeT,IAAI,CAACU,IAApB,CAAjC,EACAE,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAkCL,IAAI,CAACC,SAAL,CAAeT,IAAI,CAACW,IAApB,CAAlC,EACA,GAAGX,IAAI,CAACW,IAAL,CAAUP,MAAV,GAAqB,CAAxB,CAA0B,CAChBO,IADgB,CACT,CAAC,CAAEG,IAAI,CAAE,CAAR,CAAWC,IAAI,CAAE,CAAjB,CAAoBC,OAAO,CAAE,CAA7B,CAAgCC,MAAM,CAAE,CAAxC,CAA2CC,GAAG,CAAE,CAAhD,CAAD,CADS,CAEtBN,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAkCL,IAAI,CAACC,SAAL,CAAeE,IAAf,CAAlC,EACH,CACJ,CAED,GAAGX,IAAI,CAACmB,IAAR,CAAa,CACTP,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAkCL,IAAI,CAACC,SAAL,CAAeT,IAAI,CAACmB,IAApB,CAAlC,EACH,CA3BL,yDApCuB,8CAmEvBd,WAAW,CAAChB,IAAI,CAACiB,KAAN,CAAX,CACH,CAED,OAASnB,WAAT","sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\nfunction UserHistory(token){\r\n    const [user, setUser] = useState({});\r\n    var loggedin = true;\r\n    var newtoken = token;\r\n\r\n    useEffect(() =>{\r\n        async function getData(){\r\n    \r\n            const res = await fetch(`/api/user/profile`, {\r\n                method: \"GET\",\r\n                headers:{\r\n                    Authorization: `Bearer ${newtoken}`\r\n                }\r\n            });\r\n        \r\n            const data = await res.json();\r\n            \r\n            if(res.ok)\r\n                setUser(data);\r\n    \r\n        }\r\n\r\n        getData();\r\n\r\n    }, [newtoken]);\r\n\r\n    \r\n    if(Object.keys(user).length === 0){\r\n        token = \"\";\r\n        loggedin = false;\r\n    }\r\n\r\n    if(!loggedin)\r\n        return;\r\n    \r\n    //get cart data mongodb\r\n    async function getCartData(email){\r\n\r\n        const res = await fetch(\"/api/user/history-get\", {\r\n            method: \"POST\",\r\n            headers:{\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ email })\r\n        });\r\n    \r\n        const data = await res.json();\r\n\r\n        if(!res.ok)\r\n            return;\r\n        \r\n        \r\n        if(data.cart && data.bill){\r\n            localStorage.setItem(\"products\", JSON.stringify(data.cart));\r\n            localStorage.setItem(\"billStore\", JSON.stringify(data.bill));\r\n            if(data.bill.length === 0){\r\n                const bill = [{ tmrp: 0, tdis: 0, tdelfee: 0, amount: 0, len: 0 }];\r\n                localStorage.setItem(\"billStore\", JSON.stringify(bill));\r\n            }\r\n        }\r\n\r\n        if(data.wish){\r\n            localStorage.setItem(\"wishStore\", JSON.stringify(data.wish));\r\n        }\r\n\r\n    }\r\n\r\n    getCartData(user.email);\r\n}\r\n\r\nexport { UserHistory };"]},"metadata":{},"sourceType":"module"}